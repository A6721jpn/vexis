<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>VAXIS-CAE 統合解析ワークフロー：詳細ガイド</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }

        h1 {
            border-bottom: 2px solid #0052CC;
            color: #0052CC;
            padding-bottom: 10px;
            margin-bottom: 30px;
        }

        h2 {
            border-bottom: 1px solid #DFE1E6;
            color: #172B4D;
            margin-top: 40px;
            padding-bottom: 5px;
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
        }

        h3 {
            color: #253858;
            margin-top: 25px;
            border-left: 5px solid #0052CC;
            padding-left: 12px;
        }

        h4 {
            color: #172B4D;
            margin-top: 20px;
            font-weight: bold;
        }

        code {
            background: #F4F5F7;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 0.9em;
        }

        pre {
            background: #F4F5F7;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border: 1px solid #DFE1E6;
        }

        .info-box {
            background: #DEEBFF;
            border-left: 5px solid #0052CC;
            padding: 15px;
            margin: 20px 0;
        }

        .important-box {
            background: #EAE6FF;
            border-left: 5px solid #403294;
            padding: 15px;
            margin: 20px 0;
        }

        .success-box {
            background: #E3FCEF;
            border-left: 5px solid #36B37E;
            padding: 15px;
            margin: 20px 0;
        }

        .workflow-step {
            display: inline-block;
            background: #0052CC;
            color: white;
            padding: 2px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th,
        td {
            border: 1px solid #DFE1E6;
            padding: 12px;
            text-align: left;
            font-size: 0.95em;
        }

        th {
            background: #F4F5F7;
        }

        ul,
        ol {
            padding-left: 25px;
        }

        li {
            margin-bottom: 10px;
        }

        strong {
            color: #172B4D;
        }

        .ui-preview {
            background: #000;
            color: #0f0;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            line-height: 1.2;
            margin: 10px 0;
            border: 2px solid #333;
        }
    </style>
</head>

<body>

    <h1>VAXIS-CAE 統合解析ワークフロー</h1>

    <p>VAXIS-CAEは、ゴム弾性体の座屈解析を「メッシュ生成」から「結果抽出」まで一気通貫で行う自動解析システムです。本ガイドでは、実際の作業フローに沿って、各ステップでの注意点と設定方法を解説します。</p>

    <div class="info-box">
        <strong>コンセプト：バタフライメッシュ (Butterfly Mesh)</strong><br>
        高い計算安定性を実現するため、中心部に構造格子（正方形ブロック）を配置する手法を採用しています。これにより、深い押し込み時でも中心付近の要素が潰れにくく、座屈挙動を正確にシームレスに解析可能です。
    </div>

    <h2>Phase 1：幾何形状の作成 (CAD)</h2>
    <div class="workflow-step">STEP 1</div>
    <p>解析の土台となる2次元断面をCADで作成します。VAXIS-CAEの自動断面抽出を成功させるため、以下のルールを厳守してください。</p>

    <h3>幾何学的制約</h3>
    <ul>
        <li><strong>平面の選択:</strong> 断面形状は必ず <b>YZ平面</b>（X=0の平面）に作成してください。</li>
        <li><strong>回転中心軸:</strong> モデルの中心軸（回転の軸）を <b>Z軸</b> に完全に一致させてください。</li>
        <li><strong>原点の配置:</strong> CADの原点 (0,0,0) を回転軸上の基準点（通常は底面）に配置してください。メッシュ生成はこの原点を中心に行われます。</li>
        <li><strong>出力形式:</strong> 余分な厚みのない「サーフェス」状態で <b>STEP形式</b> (.stp / .step) で出力してください。</li>
    </ul>

    <h2>Phase 2：解析条件の設定 (Input)</h2>
    <div class="workflow-step">STEP 2</div>
    <p><code>VAXIS-CAE/input/</code> フォルダにファイルを配置し、解析パラメーターを調整します。</p>

    <h3>2.1 各種設定ファイル</h3>
    <ul>
        <li><code>*.stp</code> : Phase 1で作成した形状ファイル。</li>
        <li><code>config.yaml</code> : メッシュ密度や解析時間を制御するメイン設定。</li>
        <li><code>material.yaml</code> : 材料定数（Ogdenモデル等）の定義。</li>
    </ul>

    <h3>2.2 <td><code>config.yaml</code></td> パラメーター解説</h3>

    <h4>メッシュ制御 (`mesh:`)</h4>
    <table>
        <tr>
            <th>項目</th>
            <th>推奨値</th>
            <th>解説</th>
        </tr>
        <tr>
            <td><code>revolve_axis</code></td>
            <td>2</td>
            <td>Z軸回転（デフォルト）。基本は変更不要です。</td>
        </tr>
        <tr>
            <td><code>revolve_angle</code></td>
            <td>90</td>
            <td>回転角度。通常は1/4モデルを示す 90 を使用。</td>
        </tr>
        <tr>
            <td><code>revolve_layers</code></td>
            <td>14〜20</td>
            <td>周方向（回転方向）の分割数。</td>
        </tr>
        <tr>
            <td><code>mesh_size</code></td>
            <td>0.3〜0.5</td>
            <td>標準要素サイズ(mm)。小さいほど精緻ですが計算時間が増えます。</td>
        </tr>
        <tr>
            <td><code>mesh_dimension</code></td>
            <td>2</td>
            <td>要素次数。<b>必ず 2 (2次要素) を使用</b>してください。1次では座屈の収束が悪化します。</td>
        </tr>
        <tr>
            <td><code>ogrid_core_ratio</code></td>
            <td>0.12</td>
            <td>中心コア部の半径比率。0.1〜0.15が適正。</td>
        </tr>
        <tr>
            <td><code>core_radial_layers</code></td>
            <td>3〜5</td>
            <td>コア中心部の半径方向分割数。</td>
        </tr>
    </table>

    <h4>ソルバー制御 (`analysis:`)</h4>
    <table>
        <tr>
            <th>項目</th>
            <th>解説</th>
        </tr>
        <tr>
            <td><code>febio_path</code></td>
            <td>FEBio実行ファイル (<code>febio4.exe</code>) の絶対パスを指定。</td>
        </tr>
        <tr>
            <td><code>material_name</code></td>
            <td><code>material.yaml</code> 内の材料名と一致させてください。</td>
        </tr>
        <tr>
            <td><code>total_stroke</code></td>
            <td>最大押し込み量 (mm)。</td>
        </tr>
        <tr>
            <td><code>time_steps</code></td>
            <td>解析分割数。深い座屈を追う場合は <b>45以上</b> を推奨。</td>
        </tr>
        <tr>
            <td><code>num_threads</code></td>
            <td>CPUスレッド数。空欄時は全スレッドを使用。</td>
        </tr>
    </table>

    <h2>Phase 3：実行と進捗監視 (Process)</h2>
    <div class="workflow-step">STEP 3</div>
    <p>準備が整ったら、端末（PowerShell等）で <code>VAXIS-CAE</code> フォルダに移動し、コマンドを実行します。</p>
    <pre><code>python main.py</code></pre>

    <h3>解析画面（UI）の見方</h3>
    <div class="ui-preview">
        --- Auto Analysis Workflow (VAXIS-CAE) ---<br>
        Target Files: 12 | Mode: Full<br>
        Controls: [s] = Skip current job, [Ctrl+C] = Stop all<br>
        <br>
        case_01.stp &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;[x]Mesh [x]Prep [-]Job:
        &nbsp;15%|&nbsp;&nbsp;&nbsp;&nbsp;| 2/12<br>
        Solver Time: ################&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| 0.45/1.0 [00:12&lt;00:25]
    </div>

    <ul>
        <li><strong>[x]Mesh</strong>: メッシュ生成完了。`temp/` に `.vtk` が保存されます。</li>
        <li><strong>[x]Prep</strong>: FEBio入力ファイル（.feb）の作成完了。</li>
        <li><strong>[-]Job</strong>: ソルバー実行中。下段の <b>Solver Time</b> バーで現在の押し込み進行度（0.0〜1.0）を確認できます。</li>
    </ul>

    <div class="important-box">
        <strong>インタラクティブ操作：</strong><br>
        解析中にキーボード入力を受け付けます。
        <ul>
            <li><b>「s」キー:</b> 現在のジョブをスキップし、次のファイルへ進みます。</li>
            <li><b>「Ctrl + C」:</b> 全工程を安全に停止します。</li>
        </ul>
    </div>

    <h2>Phase 4：結果の確認と出力 (Output)</h2>
    <div class="workflow-step">STEP 4</div>
    <p>解析が完了すると、<code>temp</code> と <code>results</code> フォルダにファイルが生成されます。</p>

    <h3>4.1 <td><code>temp</code></td> フォルダ：中間ファイルの活用</h3>
    <p>異常が発生した場合の形状確認に使用します。</p>
    <ul>
        <li><code>{name}.vtk</code> : 生成された3Dメッシュ。ParaView等で読み込み、要素分割が適切か確認できます。</li>
        <li><code>{name}.feb</code> : 解析設定の最終形。FEBio Studioで開き、境界条件等の詳細を確認できます。</li>
    </ul>

    <h3>4.2 <td><code>results</code></td> フォルダ：最終成果物</h3>
    <p>解析の目的となる数値データとグラフです。</p>
    <table>
        <tr>
            <th>ファイル</th>
            <th>用途</th>
        </tr>
        <tr>
            <td><code>{name}_result.csv</code></td>
            <td><b>荷重-変位データ</b>。Excel等での二次処理用。</td>
        </tr>
        <tr>
            <td><code>{name}_graph.png</code></td>
            <td><b>自動出力グラフ</b>。座屈荷重や立ち上がりの形状を即座にチェック。</td>
        </tr>
        <tr>
            <td><code>{name}_log.txt</code></td>
            <td>ソルバーログ。エラー停止時は末尾を確認してください。</td>
        </tr>
        <tr>
            <td><code>{name}_data.txt</code></td>
            <td>抽出された押し込み部の生データ。</td>
        </tr>
    </table>

    <h2>Phase 5：最適化とトラブルシューティング</h2>
    <div class="success-box">
        <strong>解析が不安定・収束しない場合の対処法</strong>
        <ul>
            <li><strong>Negative Jacobianエラー:</strong> 押し込みが急激すぎる可能性があります。<code>time_steps</code>
                を増やすか、<code>mesh_size</code> を微調整してください。</li>
            <li><strong>要素の歪み:</strong> コア比率 <code>ogrid_core_ratio</code> が大きすぎたり小さすぎたりしないか確認してください。</li>
            <li><strong>断面抽出エラー:</strong> Phase 1のCADルール（YZ平面配置、中心軸のZ軸一致）を再確認してください。</li>
        </ul>
    </div>

    <p style="text-align: right; margin-top: 50px; color: #888;">&copy; 2025 Akihisa Okuni, U1234</p>

</body>

</html>